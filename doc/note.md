# StereoSGBMについて
このライブラリの実装での戻り値の特徴
- 欠損値は -1.0
- 画像の左側に欠損値がある。


以下の記事の中に各パラメータの効果について記載がある。
https://learnopencv.com/depth-perception-using-stereo-camera-python-c/

## SGBM の利点
- 古くからあって、OpenCVにも含まれていることもあって、多様なデバイスに対する移植がありそうであること。

## SGBMに関する不満
- cv2.StereoSGBM_create()にはたくさんのパラメータがありすぎて、適切な入力で使えていない可能性が高いのがうれしくない。
- さらには、どんなときにも安心して使える状況にないのがうれしくない。
- 被写体の周りの光源が、環境光が支配的であること、対象物の表面が散乱反射が支配的であることを仮定している。
- 左右のカメラのゲインが同等であることを仮定している。
- このことは、基線長分はなれたカメラで、対応点が移動したときに、カメラの周縁減光の特性が抑えられていることを前提とする。
- ロバストさに欠ける。そのため安心して使うことができない。
- 物体表面の法線ベクトルの向きなんていっこうに気にしていないアルゴリズムになっている。

## 原理的に対応不能なこと
- 透明物体
- 反射が無視できない物体の表面
- マッチングを行うブロックサイズよりも小さな領域に対する視差の算出
- 計算する最大の視差よりも大きな視差を与える近距離での視差の算出
- 左カメラにしか映らなくなったほど近距離の対象物への視差の算出
- 深度が不連続に変化する際に、実際にはありもしない中間の深度の点を生成してしまう。

## ステレオカメラの利点
- ステレオカメラは、カメラモジュールの設計の選択肢の自由度が高い
  - イメージセンサ
  - レンズの選択肢
  - 基線長だけカスタマイズ可能なステレオモジュールが市販されている。
  - GMSL2対応のグローバルシャッターでマルチカメラ対応のモジュールが多数市販されている。


## ロボット目的に考えたとき
- 対象物への距離の最小値が、そのカメラの検出可能距離であること
  - もしくは、他のセンサで検出できること
- 常時、自他のいずれかが移動し続けている状況下で、衝突を回避できる程度の遅延とフレームレートを維持できること 

### 配管内の計測
- 配管内の計測においては、明らかにStereoSGBMは適していないと思う。
- 一様な環境光の存在が仮定できないからだ。

## 改善の選択肢
- 偏光フィルタによる改善
  - ステレオカメラの両方のカメラに偏光フィルタ付きの方が、表面反射による輝点の影響を減らせる。
  - ステレオカメラの製品によっては予め偏光フィルタ付きが売っている。
- RGBカメラではなく、単色カメラの利用
  - ベイヤー配列などのRGBカメラでは、細かいパターンの境界に偽色を発生することがある。
  - 偽色を発生したカメラをグレースケールに変換したところで、単色カメラに及ばない。
  - ステレオカメラによっては、予め単色カメラにしてあって、それをステレオ処理の入力としている。
- パターン光の照射条件下でのステレオ計測
  - パターン光を対象物に照射すると、画像上の特徴点を付与できるので、その分だけ、ステレオ計測が改善されます。
  - 既存のステレオカメラの他に小さなプロジェクタでパターンを照射するという選択肢があります。



## 関連情報
- https://github.com/NVIDIA-AI-IOT/jetson-stereo-depth
